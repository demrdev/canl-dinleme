<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#667eea">
    <meta name="description" content="Advanced Sound Detection and Analysis System - Multi-mode sound detection, AI-powered classification, distance estimation, direction detection, 3D sound mapping, real-time spectrogram, and comprehensive audio intelligence. Professional-grade web-based sound analysis.">
    <title>Advanced Sound Detection & Analysis System Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'SF Pro Display', sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            padding: 10px;
            overflow-x: hidden;
            color: #ffffff;
        }
        
        .container {
            background: rgba(30, 30, 60, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(20px);
        }
        
        h1 {
            font-size: 32px;
            color: #00ff88;
            text-align: center;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            font-weight: 700;
        }
        
        /* Main Control Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .control-panel {
            background: rgba(20, 20, 40, 0.9);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        .panel-title {
            font-size: 18px;
            color: #00ff88;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }
        
        /* Detection Mode Controls */
        .mode-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .mode-btn {
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid rgba(0, 255, 136, 0.3);
            color: #00ff88;
            padding: 12px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .mode-btn:hover {
            background: rgba(0, 255, 136, 0.2);
            border-color: rgba(0, 255, 136, 0.6);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
        }
        
        .mode-btn.active {
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            color: #000;
            border-color: #00ff88;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.6);
        }
        
        .smart-mode-btn {
            grid-column: span 2;
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            border-color: #ff6b6b;
            color: white;
        }
        
        .smart-mode-btn.active {
            background: linear-gradient(135deg, #ff8e53, #ff6b6b);
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.6);
        }
        
        /* Sound Classification Panel */
        .sound-categories {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .sound-category {
            background: rgba(0, 255, 136, 0.05);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 8px;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .sound-category.active {
            background: rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
        }
        
        .sound-category input[type="checkbox"] {
            margin: 0;
            accent-color: #00ff88;
        }
        
        /* Advanced Controls */
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-label {
            display: block;
            font-size: 14px;
            color: #00ff88;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .slider-container {
            position: relative;
            margin-bottom: 10px;
        }
        
        .advanced-slider {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
        }
        
        .advanced-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #00ff88;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }
        
        .slider-value {
            position: absolute;
            top: -25px;
            right: 0;
            background: rgba(0, 255, 136, 0.9);
            color: #000;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        /* Main Control Buttons */
        .main-controls {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .primary-btn {
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            color: #000;
            border: none;
            padding: 20px;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 10px 25px rgba(0, 255, 136, 0.3);
        }
        
        .primary-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(0, 255, 136, 0.5);
        }
        
        .secondary-btn {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 2px solid rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .secondary-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
        }
        
        .stop-btn {
            background: rgba(255, 107, 107, 0.2);
            border-color: #ff6b6b;
            color: #ff6b6b;
        }
        
        .stop-btn:hover {
            background: rgba(255, 107, 107, 0.3);
        }
        
        /* Visualization Grid */
        .viz-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .visualization-panel {
            background: rgba(10, 10, 20, 0.9);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 15px;
            padding: 20px;
            position: relative;
        }
        
        .viz-title {
            color: #00ff88;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }
        
        /* Spectrogram */
        .spectrogram-container {
            height: 300px;
            position: relative;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .spectrogram {
            width: 100%;
            height: 100%;
        }
        
        /* 3D Sound Map */
        .sound-map-container {
            height: 300px;
            position: relative;
            background: radial-gradient(circle at center, #001122, #000);
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid rgba(0, 255, 136, 0.2);
        }
        
        .sound-compass {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            border: 2px solid rgba(0, 255, 136, 0.5);
            border-radius: 50%;
        }
        
        .compass-ring {
            position: absolute;
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 50%;
        }
        
        .compass-ring.inner {
            width: 100px;
            height: 100px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .sound-dot {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #00ff88;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.8);
            animation: pulse 2s infinite;
        }
        
        /* Status and Analysis */
        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .status-card {
            background: rgba(20, 20, 40, 0.8);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .status-value {
            font-size: 24px;
            font-weight: 700;
            color: #00ff88;
            margin-bottom: 5px;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }
        
        .status-label {
            font-size: 12px;
            color: #ccc;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* AI Analysis Panel */
        .ai-analysis {
            background: rgba(15, 15, 30, 0.9);
            border: 1px solid rgba(138, 43, 226, 0.5);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .ai-title {
            color: #8a2be2;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
            text-shadow: 0 0 10px rgba(138, 43, 226, 0.5);
        }
        
        .detected-sounds {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .sound-detection {
            background: rgba(138, 43, 226, 0.1);
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            font-size: 13px;
        }
        
        .sound-detection.active {
            background: rgba(138, 43, 226, 0.3);
            border-color: #8a2be2;
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.4);
        }
        
        .confidence-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #8a2be2, #ff6b6b);
            border-radius: 2px;
            transition: width 0.3s;
        }
        
        /* Sound Profiles */
        .profiles-section {
            background: rgba(25, 25, 50, 0.9);
            border: 1px solid rgba(255, 165, 0, 0.5);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .profiles-title {
            color: #ffa500;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
            text-shadow: 0 0 10px rgba(255, 165, 0, 0.5);
        }
        
        .profile-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .sound-profile {
            background: rgba(255, 165, 0, 0.1);
            border: 1px solid rgba(255, 165, 0, 0.3);
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .sound-profile.active {
            background: rgba(255, 165, 0, 0.3);
            border-color: #ffa500;
            box-shadow: 0 0 15px rgba(255, 165, 0, 0.4);
        }
        
        .profile-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: #ffa500;
        }
        
        .profile-info {
            font-size: 12px;
            color: #ccc;
        }
        
        /* Frequency Analyzer */
        .frequency-bands {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 2px;
            height: 100px;
            align-items: end;
            margin-bottom: 10px;
        }
        
        .freq-band {
            background: linear-gradient(to top, #00ff88, #00ff88aa);
            min-height: 2px;
            border-radius: 2px 2px 0 0;
            transition: height 0.1s;
        }
        
        /* Live Badge and Animations */
        .live-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            animation: pulse 2s infinite;
            text-transform: uppercase;
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.5);
        }
        
        /* Animations */
        @keyframes pulse {
            0%, 100% { 
                opacity: 1;
                transform: scale(1);
            }
            50% { 
                opacity: 0.8;
                transform: scale(1.05);
            }
        }
        
        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 5px rgba(0, 255, 136, 0.5);
            }
            50% {
                box-shadow: 0 0 20px rgba(0, 255, 136, 0.8);
            }
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(4);
                opacity: 0;
            }
        }
        
        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(10px);
        }
        
        .loading-overlay.show {
            display: flex;
        }
        
        .loading-content {
            background: rgba(30, 30, 60, 0.95);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            color: #fff;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(0, 255, 136, 0.1);
            border-top-color: #00ff88;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Canvas Styling */
        canvas {
            width: 100%;
            height: 100%;
            border-radius: 8px;
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .viz-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                margin: 0 5px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .main-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .main-controls {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .status-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .sound-categories {
                grid-template-columns: 1fr;
            }
            
            .mode-selector {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .status-grid {
                grid-template-columns: 1fr;
            }
            
            .detected-sounds {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div>Advanced Sound Detection System initializing...</div>
        </div>
    </div>
    
    <div class="container">
        <h1>
            <span>🎯</span>
            <span>Advanced Sound Detection & Analysis System</span>
            <span class="live-badge" id="liveBadge" style="display: none;">AI ACTIVE</span>
        </h1>
        
        <!-- Main Control Buttons -->
        <div class="main-controls">
            <button class="primary-btn" id="startBtn" onclick="startAdvancedDetection()">
                <span>🚀</span>
                <span>Start Advanced Detection</span>
            </button>
            <button class="secondary-btn stop-btn" id="stopBtn" onclick="stopDetection()">
                <span>⏹️</span>
                <span>Stop</span>
            </button>
            <button class="secondary-btn" id="muteBtn" onclick="toggleMute()">
                <span>🔇</span>
                <span>Mute</span>
            </button>
        </div>
        
        <!-- Status Grid -->
        <div class="status-grid">
            <div class="status-card">
                <div class="status-value" id="distanceValue">-- m</div>
                <div class="status-label">Distance</div>
            </div>
            <div class="status-card">
                <div class="status-value" id="directionValue">--°</div>
                <div class="status-label">Direction</div>
            </div>
            <div class="status-card">
                <div class="status-value" id="confidenceValue">--%</div>
                <div class="status-label">Confidence</div>
            </div>
        </div>
        
        <!-- Main Control Grid -->
        <div class="main-grid">
            <!-- Detection Mode Panel -->
            <div class="control-panel">
                <div class="panel-title">🎯 Detection Mode</div>
                <div class="mode-selector">
                    <button class="mode-btn" data-mode="near" onclick="setDetectionMode('near')">
                        Near (0-5m)
                    </button>
                    <button class="mode-btn" data-mode="medium" onclick="setDetectionMode('medium')">
                        Medium (5-20m)
                    </button>
                    <button class="mode-btn" data-mode="far" onclick="setDetectionMode('far')">
                        Far (20m+)
                    </button>
                    <button class="mode-btn" data-mode="all" onclick="setDetectionMode('all')">
                        All Sounds
                    </button>
                    <button class="mode-btn smart-mode-btn" data-mode="smart" onclick="setDetectionMode('smart')">
                        🧠 Smart AI Mode
                    </button>
                </div>
                
                <!-- Advanced Controls -->
                <div class="control-group">
                    <label class="control-label">Sensitivity (1x-500x)</label>
                    <div class="slider-container">
                        <input type="range" class="advanced-slider" id="sensitivitySlider" 
                               min="1" max="500" value="50" step="1" 
                               oninput="updateSensitivity(this.value)">
                        <div class="slider-value" id="sensitivityValue">50x</div>
                    </div>
                </div>
                
                <div class="control-group">
                    <label class="control-label">Frequency Range</label>
                    <div class="slider-container">
                        <input type="range" class="advanced-slider" id="freqRangeSlider" 
                               min="1" max="10" value="5" step="1" 
                               oninput="updateFreqRange(this.value)">
                        <div class="slider-value" id="freqRangeValue">Full</div>
                    </div>
                </div>
            </div>
            
            <!-- Sound Classification Panel -->
            <div class="control-panel">
                <div class="panel-title">🎵 Sound Classification</div>
                <div class="sound-categories">
                    <div class="sound-category" onclick="toggleSoundCategory('human')">
                        <input type="checkbox" id="human-sounds" checked>
                        <span>👤 Human</span>
                    </div>
                    <div class="sound-category" onclick="toggleSoundCategory('animal')">
                        <input type="checkbox" id="animal-sounds" checked>
                        <span>🐕 Animal</span>
                    </div>
                    <div class="sound-category" onclick="toggleSoundCategory('mechanical')">
                        <input type="checkbox" id="mechanical-sounds" checked>
                        <span>🔧 Mechanical</span>
                    </div>
                    <div class="sound-category" onclick="toggleSoundCategory('nature')">
                        <input type="checkbox" id="nature-sounds" checked>
                        <span>🌿 Nature</span>
                    </div>
                    <div class="sound-category" onclick="toggleSoundCategory('music')">
                        <input type="checkbox" id="music-sounds" checked>
                        <span>🎵 Music</span>
                    </div>
                    <div class="sound-category" onclick="toggleSoundCategory('emergency')">
                        <input type="checkbox" id="emergency-sounds" checked>
                        <span>🚨 Emergency</span>
                    </div>
                </div>
            </div>
            
            <!-- Advanced Features Panel -->
            <div class="control-panel">
                <div class="panel-title">⚡ Advanced Features</div>
                
                <div class="control-group">
                    <label class="control-label">Noise Cancellation</label>
                    <div class="slider-container">
                        <input type="range" class="advanced-slider" id="noiseCancelSlider" 
                               min="0" max="100" value="50" step="1" 
                               oninput="updateNoiseCancel(this.value)">
                        <div class="slider-value" id="noiseCancelValue">50%</div>
                    </div>
                </div>
                
                <div class="control-group">
                    <label class="control-label">Voice Isolation</label>
                    <div class="slider-container">
                        <input type="range" class="advanced-slider" id="voiceIsolationSlider" 
                               min="0" max="100" value="30" step="1" 
                               oninput="updateVoiceIsolation(this.value)">
                        <div class="slider-value" id="voiceIsolationValue">30%</div>
                    </div>
                </div>
                
                <div class="control-group">
                    <label class="control-label">AI Enhancement</label>
                    <div class="slider-container">
                        <input type="range" class="advanced-slider" id="aiEnhanceSlider" 
                               min="0" max="100" value="70" step="1" 
                               oninput="updateAIEnhancement(this.value)">
                        <div class="slider-value" id="aiEnhanceValue">70%</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Visualization Grid -->
        <div class="viz-grid">
            <!-- Real-time Spectrogram -->
            <div class="visualization-panel">
                <div class="viz-title">📊 Real-time Spectrogram</div>
                <div class="spectrogram-container">
                    <canvas id="spectrogram" class="spectrogram"></canvas>
                </div>
                
                <!-- Frequency Analyzer -->
                <div class="frequency-bands" id="frequencyBands">
                    <div class="freq-band" style="height: 10px;"></div>
                    <div class="freq-band" style="height: 15px;"></div>
                    <div class="freq-band" style="height: 25px;"></div>
                    <div class="freq-band" style="height: 40px;"></div>
                    <div class="freq-band" style="height: 35px;"></div>
                    <div class="freq-band" style="height: 20px;"></div>
                    <div class="freq-band" style="height: 10px;"></div>
                    <div class="freq-band" style="height: 5px;"></div>
                </div>
            </div>
            
            <!-- 3D Sound Map -->
            <div class="visualization-panel">
                <div class="viz-title">🗺️ 3D Sound Map</div>
                <div class="sound-map-container">
                    <div class="sound-compass">
                        <div class="compass-ring inner"></div>
                    </div>
                    <canvas id="soundMap"></canvas>
                </div>
            </div>
        </div>
        
        <!-- AI Analysis Panel -->
        <div class="ai-analysis">
            <div class="ai-title">🧠 AI-Powered Real-time Analysis</div>
            <div class="detected-sounds" id="detectedSounds">
                <div class="sound-detection">
                    <div>🎤 Voice Detection</div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" style="width: 0%"></div>
                    </div>
                </div>
                <div class="sound-detection">
                    <div>🔊 Volume Analysis</div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" style="width: 0%"></div>
                    </div>
                </div>
                <div class="sound-detection">
                    <div>📍 Direction Finder</div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" style="width: 0%"></div>
                    </div>
                </div>
                <div class="sound-detection">
                    <div>📏 Distance Calc</div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Sound Profiles Section -->
        <div class="profiles-section">
            <div class="profiles-title">💾 Sound Profiles & Recognition</div>
            <div class="profile-list" id="profileList">
                <div class="sound-profile" onclick="loadProfile('default')">
                    <div class="profile-name">Default Profile</div>
                    <div class="profile-info">General purpose detection</div>
                </div>
                <div class="sound-profile" onclick="loadProfile('security')">
                    <div class="profile-name">Security Mode</div>
                    <div class="profile-info">Intruder detection</div>
                </div>
                <div class="sound-profile" onclick="loadProfile('nature')">
                    <div class="profile-name">Nature Sounds</div>
                    <div class="profile-info">Wildlife monitoring</div>
                </div>
                <div class="sound-profile" onclick="loadProfile('urban')">
                    <div class="profile-name">Urban Environment</div>
                    <div class="profile-info">City sound analysis</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ADVANCED SOUND DETECTION & ANALYSIS SYSTEM
        // Professional-grade AI-powered audio intelligence platform
        
        // ==================== CORE SYSTEM VARIABLES ====================
        
        // Audio Context and Processing
        let audioContext = null;
        let stream = null;
        let source = null;
        let masterGainNode = null;
        let analyser = null;
        let stereoAnalyser = { left: null, right: null };
        
        // Advanced Processing Nodes
        let multiStagePreAmp = [];
        let frequencyFilters = {
            subBass: null,      // 10-80Hz
            bass: null,         // 80-320Hz  
            midrange: null,     // 320-2500Hz
            presence: null,     // 2.5-8kHz
            brilliance: null    // 8-24kHz
        };
        let dynamicsProcessing = {
            compressor: null,
            limiter: null,
            expander: null,
            noiseGate: null
        };
        let spatialProcessing = {
            stereoSplitter: null,
            leftAnalyser: null,
            rightAnalyser: null
        };
        
        // Detection System State
        let detectionMode = 'medium'; // near, medium, far, all, smart
        let currentSensitivity = 50;
        let isDetectionActive = false;
        let isMuted = false;
        let animationFrames = [];
        
        // Sound Classification System
        let soundCategories = {
            human: { enabled: true, confidence: 0, lastDetection: 0 },
            animal: { enabled: true, confidence: 0, lastDetection: 0 },
            mechanical: { enabled: true, confidence: 0, lastDetection: 0 },
            nature: { enabled: true, confidence: 0, lastDetection: 0 },
            music: { enabled: true, confidence: 0, lastDetection: 0 },
            emergency: { enabled: true, confidence: 0, lastDetection: 0 }
        };
        
        // AI Analysis System
        let aiAnalysis = {
            distanceEstimate: 0,
            directionAngle: 0,
            overallConfidence: 0,
            dominantFrequency: 0,
            spectralCentroid: 0,
            spectralRolloff: 0,
            zeroCrossingRate: 0,
            mfcc: []
        };
        
        // Sound Profile System
        let soundProfiles = {
            current: 'default',
            profiles: {
                default: { name: 'Default Profile', settings: {} },
                security: { name: 'Security Mode', settings: {} },
                nature: { name: 'Nature Sounds', settings: {} },
                urban: { name: 'Urban Environment', settings: {} }
            }
        };
        
        // Real-time Analysis Data
        let analysisData = {
            frequencyData: null,
            timeData: null,
            stereoData: { left: null, right: null },
            spectrogramHistory: [],
            peakHistory: [],
            volumeHistory: []
        };
        
        // Advanced Settings
        let advancedSettings = {
            noiseCancel: 50,
            voiceIsolation: 30,
            aiEnhancement: 70,
            freqRange: 5,
            adaptiveMode: false
        };
        
        // DOM Elements
        const loadingOverlay = document.getElementById('loadingOverlay');
        const liveBadge = document.getElementById('liveBadge');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const muteBtn = document.getElementById('muteBtn');
        
        // Status Elements
        const distanceValue = document.getElementById('distanceValue');
        const directionValue = document.getElementById('directionValue');
        const confidenceValue = document.getElementById('confidenceValue');
        
        // Canvas Elements
        const spectrogramCanvas = document.getElementById('spectrogram');
        const spectrogramCtx = spectrogramCanvas.getContext('2d');
        const soundMapCanvas = document.getElementById('soundMap');
        const soundMapCtx = soundMapCanvas.getContext('2d');
        
        // Frequency Bands
        const frequencyBands = document.getElementById('frequencyBands').children;
        
        // ==================== ADVANCED AUDIO PROCESSING FUNCTIONS ====================
        
        // Multi-stage frequency filter system
        function createFrequencyFilters(audioContext) {
            return {
                // Sub-bass filter (10-80Hz) - for detecting vibrations and ultra-low sounds
                subBass: (() => {
                    const filter = audioContext.createBiquadFilter();
                    filter.type = 'peaking';
                    filter.frequency.setValueAtTime(45, audioContext.currentTime);
                    filter.Q.setValueAtTime(2.0, audioContext.currentTime);
                    filter.gain.setValueAtTime(18, audioContext.currentTime);
                    return filter;
                })(),
                
                // Bass filter (80-320Hz) - for room acoustics and mechanical sounds
                bass: (() => {
                    const filter = audioContext.createBiquadFilter();
                    filter.type = 'peaking';
                    filter.frequency.setValueAtTime(160, audioContext.currentTime);
                    filter.Q.setValueAtTime(1.2, audioContext.currentTime);
                    filter.gain.setValueAtTime(12, audioContext.currentTime);
                    return filter;
                })(),
                
                // Midrange filter (320-2500Hz) - for speech and vocals
                midrange: (() => {
                    const filter = audioContext.createBiquadFilter();
                    filter.type = 'peaking';
                    filter.frequency.setValueAtTime(1200, audioContext.currentTime);
                    filter.Q.setValueAtTime(0.8, audioContext.currentTime);
                    filter.gain.setValueAtTime(15, audioContext.currentTime);
                    return filter;
                })(),
                
                // Presence filter (2.5-8kHz) - for clarity and detail
                presence: (() => {
                    const filter = audioContext.createBiquadFilter();
                    filter.type = 'peaking';
                    filter.frequency.setValueAtTime(5000, audioContext.currentTime);
                    filter.Q.setValueAtTime(1.0, audioContext.currentTime);
                    filter.gain.setValueAtTime(10, audioContext.currentTime);
                    return filter;
                })(),
                
                // Brilliance filter (8-24kHz) - for ultra-high frequency detection
                brilliance: (() => {
                    const filter = audioContext.createBiquadFilter();
                    filter.type = 'highshelf';
                    filter.frequency.setValueAtTime(16000, audioContext.currentTime);
                    filter.gain.setValueAtTime(15, audioContext.currentTime);
                    return filter;
                })()
            };
        }
        
        // Multi-stage dynamics processing
        function createDynamicsProcessing(audioContext) {
            return {
                // Compressor for dynamic range control
                compressor: (() => {
                    const comp = audioContext.createDynamicsCompressor();
                    comp.threshold.setValueAtTime(-24, audioContext.currentTime);
                    comp.knee.setValueAtTime(12, audioContext.currentTime);
                    comp.ratio.setValueAtTime(4, audioContext.currentTime);
                    comp.attack.setValueAtTime(0.003, audioContext.currentTime);
                    comp.release.setValueAtTime(0.1, audioContext.currentTime);
                    return comp;
                })(),
                
                // Limiter for peak control
                limiter: (() => {
                    const lim = audioContext.createDynamicsCompressor();
                    lim.threshold.setValueAtTime(-3, audioContext.currentTime);
                    lim.knee.setValueAtTime(0, audioContext.currentTime);
                    lim.ratio.setValueAtTime(20, audioContext.currentTime);
                    lim.attack.setValueAtTime(0.0001, audioContext.currentTime);
                    lim.release.setValueAtTime(0.01, audioContext.currentTime);
                    return lim;
                })(),
                
                // Expander for quiet sound enhancement
                expander: (() => {
                    const exp = audioContext.createDynamicsCompressor();
                    exp.threshold.setValueAtTime(-60, audioContext.currentTime);
                    exp.knee.setValueAtTime(5, audioContext.currentTime);
                    exp.ratio.setValueAtTime(0.25, audioContext.currentTime);
                    exp.attack.setValueAtTime(0.0005, audioContext.currentTime);
                    exp.release.setValueAtTime(0.2, audioContext.currentTime);
                    return exp;
                })(),
                
                // Noise gate for background noise suppression
                noiseGate: (() => {
                    const gate = audioContext.createGain();
                    gate.gain.setValueAtTime(1.0, audioContext.currentTime);
                    return gate;
                })()
            };
        }
        
        // Stereo spatial processing
        function createSpatialProcessing(audioContext) {
            const splitter = audioContext.createChannelSplitter(2);
            const leftAnalyser = audioContext.createAnalyser();
            const rightAnalyser = audioContext.createAnalyser();
            
            // Configure analysers for stereo processing
            [leftAnalyser, rightAnalyser].forEach(analyser => {
                analyser.fftSize = 4096;
                analyser.smoothingTimeConstant = 0.2;
                analyser.minDecibels = -120;
                analyser.maxDecibels = 0;
            });
            
            splitter.connect(leftAnalyser, 0);
            splitter.connect(rightAnalyser, 1);
            
            return {
                stereoSplitter: splitter,
                leftAnalyser,
                rightAnalyser
            };
        }
        
        // AI-powered sound classification
        function classifySoundAI(frequencyData, timeData) {
            // Advanced spectral analysis for sound classification
            const spectralFeatures = calculateSpectralFeatures(frequencyData);
            const temporalFeatures = calculateTemporalFeatures(timeData);
            
            // Machine learning-inspired classification based on audio features
            const classifications = {
                human: classifyHumanSounds(spectralFeatures, temporalFeatures),
                animal: classifyAnimalSounds(spectralFeatures, temporalFeatures),
                mechanical: classifyMechanicalSounds(spectralFeatures, temporalFeatures),
                nature: classifyNatureSounds(spectralFeatures, temporalFeatures),
                music: classifyMusicSounds(spectralFeatures, temporalFeatures),
                emergency: classifyEmergencySounds(spectralFeatures, temporalFeatures)
            };
            
            return classifications;
        }
        
        // Calculate spectral features for AI analysis
        function calculateSpectralFeatures(frequencyData) {
            const nyquist = audioContext.sampleRate / 2;
            let spectralCentroid = 0;
            let spectralRolloff = 0;
            let spectralFlux = 0;
            let totalMagnitude = 0;
            
            // Calculate spectral centroid
            for (let i = 0; i < frequencyData.length; i++) {
                const frequency = (i / frequencyData.length) * nyquist;
                const magnitude = Math.pow(10, frequencyData[i] / 20);
                spectralCentroid += frequency * magnitude;
                totalMagnitude += magnitude;
            }
            spectralCentroid /= totalMagnitude;
            
            // Calculate spectral rolloff (85% of energy)
            let cumulativeMagnitude = 0;
            const threshold = totalMagnitude * 0.85;
            for (let i = 0; i < frequencyData.length; i++) {
                const magnitude = Math.pow(10, frequencyData[i] / 20);
                cumulativeMagnitude += magnitude;
                if (cumulativeMagnitude >= threshold) {
                    spectralRolloff = (i / frequencyData.length) * nyquist;
                    break;
                }
            }
            
            return {
                centroid: spectralCentroid,
                rolloff: spectralRolloff,
                flux: spectralFlux,
                bandwidth: spectralRolloff - spectralCentroid
            };
        }
        
        // Calculate temporal features
        function calculateTemporalFeatures(timeData) {
            let zeroCrossingRate = 0;
            let rms = 0;
            
            // Zero crossing rate
            for (let i = 1; i < timeData.length; i++) {
                if ((timeData[i] >= 0) !== (timeData[i - 1] >= 0)) {
                    zeroCrossingRate++;
                }
            }
            zeroCrossingRate /= timeData.length;
            
            // RMS energy
            for (let i = 0; i < timeData.length; i++) {
                rms += timeData[i] * timeData[i];
            }
            rms = Math.sqrt(rms / timeData.length);
            
            return {
                zeroCrossingRate,
                rms,
                energy: rms
            };
        }
        
        // Sound classification functions
        function classifyHumanSounds(spectral, temporal) {
            // Human voice characteristics: 85-255Hz fundamental, formants at specific frequencies
            let confidence = 0;
            
            if (spectral.centroid > 200 && spectral.centroid < 4000) confidence += 0.3;
            if (temporal.zeroCrossingRate > 0.1 && temporal.zeroCrossingRate < 0.5) confidence += 0.2;
            if (spectral.bandwidth > 500 && spectral.bandwidth < 3000) confidence += 0.3;
            if (temporal.rms > 0.01) confidence += 0.2;
            
            return Math.min(confidence, 1.0);
        }
        
        function classifyAnimalSounds(spectral, temporal) {
            let confidence = 0;
            
            // Animal sounds often have irregular patterns and specific frequency ranges
            if (spectral.centroid > 500 && spectral.centroid < 8000) confidence += 0.3;
            if (temporal.zeroCrossingRate > 0.2) confidence += 0.3;
            if (spectral.rolloff > 2000) confidence += 0.2;
            if (temporal.energy > 0.02) confidence += 0.2;
            
            return Math.min(confidence, 1.0);
        }
        
        function classifyMechanicalSounds(spectral, temporal) {
            let confidence = 0;
            
            // Mechanical sounds: regular patterns, often broadband
            if (spectral.bandwidth > 2000) confidence += 0.4;
            if (temporal.zeroCrossingRate > 0.3) confidence += 0.3;
            if (spectral.rolloff > 5000) confidence += 0.3;
            
            return Math.min(confidence, 1.0);
        }
        
        function classifyNatureSounds(spectral, temporal) {
            let confidence = 0;
            
            // Nature sounds: often have specific spectral characteristics
            if (spectral.centroid < 2000) confidence += 0.3;
            if (temporal.zeroCrossingRate < 0.3) confidence += 0.3;
            if (spectral.bandwidth > 1000) confidence += 0.4;
            
            return Math.min(confidence, 1.0);
        }
        
        function classifyMusicSounds(spectral, temporal) {
            let confidence = 0;
            
            // Musical content: harmonic structure, specific frequency relationships
            if (spectral.centroid > 300 && spectral.centroid < 5000) confidence += 0.3;
            if (spectral.bandwidth > 800 && spectral.bandwidth < 4000) confidence += 0.3;
            if (temporal.rms > 0.005) confidence += 0.4;
            
            return Math.min(confidence, 1.0);
        }
        
        function classifyEmergencySounds(spectral, temporal) {
            let confidence = 0;
            
            // Emergency sounds: sirens, alarms - often have specific patterns
            if (spectral.centroid > 800 && spectral.centroid < 3000) confidence += 0.4;
            if (temporal.energy > 0.03) confidence += 0.3;
            if (spectral.rolloff > 3000) confidence += 0.3;
            
            return Math.min(confidence, 1.0);
        }
        
        // Distance estimation using amplitude and frequency analysis
        function estimateDistance(frequencyData, timeData, mode = 'medium') {
            const rms = calculateTemporalFeatures(timeData).rms;
            const spectralFeatures = calculateSpectralFeatures(frequencyData);
            
            // Base distance calculation using inverse square law approximation
            let baseDistance = 1 / Math.max(rms * 100, 0.001);
            
            // Adjust based on spectral characteristics
            if (spectralFeatures.rolloff < 2000) {
                // Low frequency content travels further
                baseDistance *= 1.5;
            } else if (spectralFeatures.rolloff > 8000) {
                // High frequency content attenuates quickly
                baseDistance *= 0.7;
            }
            
            // Mode-specific adjustments
            switch (mode) {
                case 'near':
                    return Math.min(baseDistance, 5);
                case 'medium':
                    return Math.min(baseDistance, 20);
                case 'far':
                    return baseDistance;
                case 'all':
                    return baseDistance;
                default:
                    return baseDistance;
            }
        }
        
        // Direction estimation using stereo analysis
        function estimateDirection(leftData, rightData) {
            let leftEnergy = 0;
            let rightEnergy = 0;
            let crossCorrelation = 0;
            
            // Calculate energy in each channel
            for (let i = 0; i < leftData.length; i++) {
                leftEnergy += leftData[i] * leftData[i];
                rightEnergy += rightData[i] * rightData[i];
            }
            
            // Calculate phase difference for direction estimation
            const energyDifference = (rightEnergy - leftEnergy) / (rightEnergy + leftEnergy + 0.001);
            
            // Convert to angle (simplified model)
            const angle = energyDifference * 90; // -90 to +90 degrees
            
            return angle;
        }
        
        // ==================== MAIN SYSTEM FUNCTIONS ====================
        
        // Detection mode configuration
        function setDetectionMode(mode) {
            detectionMode = mode;
            
            // Update UI
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
            
            // Configure audio processing based on mode
            if (isDetectionActive) {
                configureAudioProcessing();
            }
            
            console.log(`Detection mode set to: ${mode}`);
        }
        
        // Configure audio processing based on current settings
        function configureAudioProcessing() {
            if (!audioContext) return;
            
            const sensitivity = currentSensitivity / 100;
            const modeMultipliers = {
                near: 2.0,
                medium: 1.0,
                far: 0.5,
                all: 0.8,
                smart: 1.2
            };
            
            const finalGain = sensitivity * modeMultipliers[detectionMode];
            
            // Update pre-amplification stages
            multiStagePreAmp.forEach((amp, index) => {
                if (amp) {
                    const stageGain = finalGain * (0.8 + index * 0.1);
                    amp.gain.setTargetAtTime(stageGain, audioContext.currentTime, 0.1);
                }
            });
        }
        
        // Main detection system startup
        async function startAdvancedDetection() {
            if (isDetectionActive) return;
            
            try {
                showLoading(true);
                
                // Request microphone permission
                await requestMicrophoneAccess();
                
                // Initialize audio context with maximum quality
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                audioContext = new AudioContext({
                    latencyHint: 'interactive',
                    sampleRate: 96000
                });
                
                if (audioContext.state === 'suspended') {
                    await audioContext.resume();
                }
                
                // Get ultra-high quality audio stream
                const constraints = {
                    audio: {
                        echoCancellation: false,
                        noiseSuppression: false,
                        autoGainControl: false,
                        channelCount: 2,
                        sampleRate: 96000,
                        sampleSize: 32
                    }
                };
                
                stream = await navigator.mediaDevices.getUserMedia(constraints);
                source = audioContext.createMediaStreamSource(stream);
                
                // Create comprehensive audio processing chain
                await buildAdvancedProcessingChain();
                
                // Start AI analysis and visualization
                startAIAnalysis();
                startAdvancedVisualization();
                
                // Update system state
                isDetectionActive = true;
                startBtn.disabled = true;
                stopBtn.disabled = false;
                muteBtn.disabled = false;
                liveBadge.style.display = 'inline-block';
                
                console.log('🚀 Advanced Sound Detection System ACTIVATED!');
                console.log(`- Sample Rate: ${audioContext.sampleRate}Hz`);
                console.log(`- Detection Mode: ${detectionMode}`);
                console.log(`- Sensitivity: ${currentSensitivity}x`);
                console.log('- AI Classification: ENABLED');
                console.log('- 3D Sound Mapping: ACTIVE');
                console.log('- Real-time Spectrogram: RUNNING');
                
            } catch (error) {
                console.error('Failed to start detection system:', error);
                alert('Failed to start detection system: ' + error.message);
            } finally {
                showLoading(false);
            }
        }
        
        // Request microphone access with comprehensive error handling
        async function requestMicrophoneAccess() {
            try {
                // Test basic access first
                const testStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                testStream.getTracks().forEach(track => track.stop());
                
                console.log('✅ Microphone access granted');
                
            } catch (error) {
                let errorMessage = 'Microphone access failed: ';
                
                switch (error.name) {
                    case 'NotAllowedError':
                        errorMessage = 'Microphone permission denied. Please allow microphone access.';
                        break;
                    case 'NotFoundError':
                        errorMessage = 'No microphone found. Please connect a microphone.';
                        break;
                    case 'NotReadableError':
                        errorMessage = 'Microphone is in use by another application.';
                        break;
                    default:
                        errorMessage += error.message;
                }
                
                throw new Error(errorMessage);
            }
        }
        
        // Build comprehensive audio processing chain
        async function buildAdvancedProcessingChain() {
            // Create multi-stage pre-amplification
            for (let i = 0; i < 3; i++) {
                const preAmp = audioContext.createGain();
                preAmp.gain.setValueAtTime(1.0 + i * 0.3, audioContext.currentTime);
                multiStagePreAmp.push(preAmp);
            }
            
            // Create frequency filters
            frequencyFilters = createFrequencyFilters(audioContext);
            
            // Create dynamics processing
            dynamicsProcessing = createDynamicsProcessing(audioContext);
            
            // Create spatial processing
            spatialProcessing = createSpatialProcessing(audioContext);
            
            // Create master analyser
            analyser = audioContext.createAnalyser();
            analyser.fftSize = 32768; // Maximum FFT size for detailed analysis
            analyser.smoothingTimeConstant = 0.1;
            analyser.minDecibels = -120;
            analyser.maxDecibels = 0;
            
            // Create master gain
            masterGainNode = audioContext.createGain();
            masterGainNode.gain.setValueAtTime(currentSensitivity / 100, audioContext.currentTime);
            
            // Connect the complete processing chain
            let currentNode = source;
            
            // Multi-stage pre-amplification
            multiStagePreAmp.forEach(preAmp => {
                currentNode.connect(preAmp);
                currentNode = preAmp;
            });
            
            // Frequency processing chain
            currentNode.connect(frequencyFilters.subBass);
            frequencyFilters.subBass.connect(frequencyFilters.bass);
            frequencyFilters.bass.connect(frequencyFilters.midrange);
            frequencyFilters.midrange.connect(frequencyFilters.presence);
            frequencyFilters.presence.connect(frequencyFilters.brilliance);
            
            // Dynamics processing chain
            frequencyFilters.brilliance.connect(dynamicsProcessing.expander);
            dynamicsProcessing.expander.connect(dynamicsProcessing.compressor);
            dynamicsProcessing.compressor.connect(dynamicsProcessing.noiseGate);
            dynamicsProcessing.noiseGate.connect(dynamicsProcessing.limiter);
            
            // Connect to spatial processing for stereo analysis
            dynamicsProcessing.limiter.connect(spatialProcessing.stereoSplitter);
            
            // Connect to master gain and analyser
            dynamicsProcessing.limiter.connect(masterGainNode);
            masterGainNode.connect(analyser);
            
            // Connect to output (when not muted)
            if (!isMuted) {
                masterGainNode.connect(audioContext.destination);
            }
            
            console.log('🔧 Advanced audio processing chain built successfully');
        }
        
        // Start AI-powered analysis
        function startAIAnalysis() {
            const bufferLength = analyser.frequencyBinCount;
            analysisData.frequencyData = new Float32Array(bufferLength);
            analysisData.timeData = new Float32Array(analyser.fftSize);
            analysisData.stereoData.left = new Float32Array(spatialProcessing.leftAnalyser.frequencyBinCount);
            analysisData.stereoData.right = new Float32Array(spatialProcessing.rightAnalyser.frequencyBinCount);
            
            function analyzeLoop() {
                if (!isDetectionActive) return;
                
                // Get analysis data
                analyser.getFloatFrequencyData(analysisData.frequencyData);
                analyser.getFloatTimeDomainData(analysisData.timeData);
                spatialProcessing.leftAnalyser.getFloatFrequencyData(analysisData.stereoData.left);
                spatialProcessing.rightAnalyser.getFloatFrequencyData(analysisData.stereoData.right);
                
                // AI sound classification
                const classifications = classifySoundAI(analysisData.frequencyData, analysisData.timeData);
                
                // Update sound categories
                Object.keys(soundCategories).forEach(category => {
                    if (soundCategories[category].enabled) {
                        soundCategories[category].confidence = classifications[category] || 0;
                        if (classifications[category] > 0.3) {
                            soundCategories[category].lastDetection = Date.now();
                        }
                    }
                });
                
                // Distance and direction estimation
                aiAnalysis.distanceEstimate = estimateDistance(
                    analysisData.frequencyData, 
                    analysisData.timeData, 
                    detectionMode
                );
                aiAnalysis.directionAngle = estimateDirection(
                    analysisData.stereoData.left, 
                    analysisData.stereoData.right
                );
                
                // Calculate overall confidence
                const confidenceValues = Object.values(classifications);
                aiAnalysis.overallConfidence = Math.max(...confidenceValues);
                
                // Update UI
                updateStatusDisplay();
                updateAIDisplay();
                
                // Continue analysis loop
                setTimeout(analyzeLoop, 50); // 20 FPS analysis
            }
            
            analyzeLoop();
        }
        
        // Start advanced visualizations
        function startAdvancedVisualization() {
            setupCanvases();
            startSpectrogramVisualization();
            start3DSoundMapVisualization();
            startFrequencyBandVisualization();
        }
        
        // Setup canvas dimensions
        function setupCanvases() {
            [spectrogramCanvas, soundMapCanvas].forEach(canvas => {
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width * window.devicePixelRatio;
                canvas.height = rect.height * window.devicePixelRatio;
                canvas.getContext('2d').scale(window.devicePixelRatio, window.devicePixelRatio);
            });
        }
        
        // Real-time spectrogram visualization
        function startSpectrogramVisualization() {
            let spectrogramData = [];
            const maxHistory = 200;
            
            function drawSpectrogram() {
                if (!isDetectionActive) return;
                
                const width = spectrogramCanvas.width / window.devicePixelRatio;
                const height = spectrogramCanvas.height / window.devicePixelRatio;
                
                // Get current frequency data
                const bufferLength = analyser.frequencyBinCount;
                const dataArray = new Uint8Array(bufferLength);
                analyser.getByteFrequencyData(dataArray);
                
                // Add to history
                spectrogramData.push(Array.from(dataArray));
                if (spectrogramData.length > maxHistory) {
                    spectrogramData.shift();
                }
                
                // Clear canvas
                spectrogramCtx.fillStyle = '#000000';
                spectrogramCtx.fillRect(0, 0, width, height);
                
                // Draw spectrogram
                const barWidth = width / spectrogramData.length;
                const barHeight = height / bufferLength;
                
                spectrogramData.forEach((frame, x) => {
                    frame.forEach((magnitude, y) => {
                        const intensity = magnitude / 255;
                        const hue = (y / bufferLength) * 240; // Blue to red spectrum
                        const saturation = 100;
                        const lightness = intensity * 70;
                        
                        spectrogramCtx.fillStyle = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
                        spectrogramCtx.fillRect(
                            x * barWidth,
                            height - (y * barHeight),
                            barWidth + 1,
                            barHeight + 1
                        );
                    });
                });
                
                requestAnimationFrame(drawSpectrogram);
            }
            
            drawSpectrogram();
        }
        
        // 3D sound map visualization
        function start3DSoundMapVisualization() {
            function drawSoundMap() {
                if (!isDetectionActive) return;
                
                const width = soundMapCanvas.width / window.devicePixelRatio;
                const height = soundMapCanvas.height / window.devicePixelRatio;
                const centerX = width / 2;
                const centerY = height / 2;
                
                // Clear canvas with dark background
                soundMapCtx.fillStyle = '#000011';
                soundMapCtx.fillRect(0, 0, width, height);
                
                // Draw compass rings
                soundMapCtx.strokeStyle = 'rgba(0, 255, 136, 0.3)';
                soundMapCtx.lineWidth = 1;
                
                for (let i = 1; i <= 4; i++) {
                    const radius = (Math.min(width, height) / 2) * (i / 4) * 0.8;
                    soundMapCtx.beginPath();
                    soundMapCtx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                    soundMapCtx.stroke();
                }
                
                // Draw direction indicators
                const directions = ['N', 'E', 'S', 'W'];
                soundMapCtx.fillStyle = '#00ff88';
                soundMapCtx.font = '14px monospace';
                soundMapCtx.textAlign = 'center';
                
                directions.forEach((dir, i) => {
                    const angle = (i * Math.PI) / 2 - Math.PI / 2;
                    const radius = (Math.min(width, height) / 2) * 0.9;
                    const x = centerX + Math.cos(angle) * radius;
                    const y = centerY + Math.sin(angle) * radius;
                    soundMapCtx.fillText(dir, x, y);
                });
                
                // Draw sound sources based on AI analysis
                if (aiAnalysis.overallConfidence > 0.1) {
                    const distance = Math.min(aiAnalysis.distanceEstimate, 50);
                    const angle = (aiAnalysis.directionAngle * Math.PI) / 180;
                    const maxRadius = (Math.min(width, height) / 2) * 0.7;
                    const dotRadius = maxRadius * (1 - distance / 50);
                    
                    const x = centerX + Math.cos(angle) * dotRadius;
                    const y = centerY + Math.sin(angle) * dotRadius;
                    
                    // Draw sound source
                    const size = 5 + aiAnalysis.overallConfidence * 15;
                    const opacity = aiAnalysis.overallConfidence;
                    
                    soundMapCtx.fillStyle = `rgba(0, 255, 136, ${opacity})`;
                    soundMapCtx.beginPath();
                    soundMapCtx.arc(x, y, size, 0, Math.PI * 2);
                    soundMapCtx.fill();
                    
                    // Add glow effect
                    const gradient = soundMapCtx.createRadialGradient(x, y, 0, x, y, size * 3);
                    gradient.addColorStop(0, `rgba(0, 255, 136, ${opacity * 0.5})`);
                    gradient.addColorStop(1, 'rgba(0, 255, 136, 0)');
                    
                    soundMapCtx.fillStyle = gradient;
                    soundMapCtx.beginPath();
                    soundMapCtx.arc(x, y, size * 3, 0, Math.PI * 2);
                    soundMapCtx.fill();
                }
                
                requestAnimationFrame(drawSoundMap);
            }
            
            drawSoundMap();
        }
        
        // Frequency band visualization
        function startFrequencyBandVisualization() {
            function updateFrequencyBands() {
                if (!isDetectionActive) return;
                
                const bufferLength = analyser.frequencyBinCount;
                const dataArray = new Uint8Array(bufferLength);
                analyser.getByteFrequencyData(dataArray);
                
                // Update frequency band heights
                const bandsPerBin = Math.floor(bufferLength / frequencyBands.length);
                
                for (let i = 0; i < frequencyBands.length; i++) {
                    let sum = 0;
                    for (let j = 0; j < bandsPerBin; j++) {
                        sum += dataArray[i * bandsPerBin + j];
                    }
                    const average = sum / bandsPerBin;
                    const height = (average / 255) * 100;
                    
                    frequencyBands[i].style.height = height + 'px';
                    frequencyBands[i].style.opacity = Math.max(0.3, height / 100);
                }
                
                requestAnimationFrame(updateFrequencyBands);
            }
            
            updateFrequencyBands();
        }
        
        // Update status display
        function updateStatusDisplay() {
            distanceValue.textContent = aiAnalysis.distanceEstimate.toFixed(1) + 'm';
            directionValue.textContent = aiAnalysis.directionAngle.toFixed(0) + '°';
            confidenceValue.textContent = (aiAnalysis.overallConfidence * 100).toFixed(0) + '%';
        }
        
        // Update AI analysis display
        function updateAIDisplay() {
            const detectionElements = document.querySelectorAll('.sound-detection');
            const categories = Object.keys(soundCategories);
            
            detectionElements.forEach((element, index) => {
                if (categories[index]) {
                    const category = categories[index];
                    const confidence = soundCategories[category].confidence;
                    const confidenceFill = element.querySelector('.confidence-fill');
                    
                    if (confidenceFill) {
                        confidenceFill.style.width = (confidence * 100) + '%';
                        
                        if (confidence > 0.5) {
                            element.classList.add('active');
                        } else {
                            element.classList.remove('active');
                        }
                    }
                }
            });
        }
        
        // Control functions
        function stopDetection() {
            if (!isDetectionActive) return;
            
            // Stop all processing
            animationFrames.forEach(id => cancelAnimationFrame(id));
            animationFrames = [];
            
            // Close audio context
            if (audioContext) {
                audioContext.close();
                audioContext = null;
            }
            
            // Stop stream
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            
            // Reset system state
            isDetectionActive = false;
            startBtn.disabled = false;
            stopBtn.disabled = true;
            muteBtn.disabled = true;
            liveBadge.style.display = 'none';
            
            console.log('🛑 Advanced Sound Detection System STOPPED');
        }
        
        function toggleMute() {
            if (!masterGainNode) return;
            
            isMuted = !isMuted;
            
            if (isMuted) {
                masterGainNode.disconnect();
                muteBtn.innerHTML = '<span>🔊</span><span>Unmute</span>';
            } else {
                masterGainNode.connect(audioContext.destination);
                muteBtn.innerHTML = '<span>🔇</span><span>Mute</span>';
            }
        }
        
        // Control panel functions
        function toggleSoundCategory(category) {
            const checkbox = document.getElementById(category + '-sounds');
            soundCategories[category].enabled = checkbox.checked;
            
            const categoryElement = checkbox.parentElement;
            if (checkbox.checked) {
                categoryElement.classList.add('active');
            } else {
                categoryElement.classList.remove('active');
            }
        }
        
        function updateSensitivity(value) {
            currentSensitivity = parseInt(value);
            document.getElementById('sensitivityValue').textContent = currentSensitivity + 'x';
            
            if (isDetectionActive) {
                configureAudioProcessing();
            }
        }
        
        function updateFreqRange(value) {
            const ranges = ['Sub-bass', 'Bass', 'Mid', 'High', 'Full', 'Ultra', 'Max', 'Extreme', 'Ultimate', 'Beyond'];
            document.getElementById('freqRangeValue').textContent = ranges[parseInt(value) - 1] || 'Full';
            advancedSettings.freqRange = parseInt(value);
        }
        
        function updateNoiseCancel(value) {
            advancedSettings.noiseCancel = parseInt(value);
            document.getElementById('noiseCancelValue').textContent = value + '%';
            
            // Apply noise cancellation
            if (dynamicsProcessing.noiseGate && isDetectionActive) {
                const threshold = -60 + (parseInt(value) * 0.4);
                dynamicsProcessing.noiseGate.gain.setTargetAtTime(
                    Math.max(0.1, 1 - parseInt(value) / 200), 
                    audioContext.currentTime, 
                    0.1
                );
            }
        }
        
        function updateVoiceIsolation(value) {
            advancedSettings.voiceIsolation = parseInt(value);
            document.getElementById('voiceIsolationValue').textContent = value + '%';
            
            // Apply voice isolation to midrange filter
            if (frequencyFilters.midrange && isDetectionActive) {
                const boost = 5 + (parseInt(value) * 0.2);
                frequencyFilters.midrange.gain.setTargetAtTime(boost, audioContext.currentTime, 0.1);
            }
        }
        
        function updateAIEnhancement(value) {
            advancedSettings.aiEnhancement = parseInt(value);
            document.getElementById('aiEnhanceValue').textContent = value + '%';
        }
        
        function loadProfile(profileName) {
            soundProfiles.current = profileName;
            
            // Update UI
            document.querySelectorAll('.sound-profile').forEach(profile => {
                profile.classList.remove('active');
            });
            document.querySelector(`[onclick="loadProfile('${profileName}')"]`).classList.add('active');
            
            // Apply profile settings
            console.log(`Profile loaded: ${profileName}`);
        }
        
        // Utility functions
        function showLoading(show) {
            loadingOverlay.style.display = show ? 'flex' : 'none';
        }
        
        // Initialize system
        window.addEventListener('DOMContentLoaded', () => {
            // Set initial detection mode
            setDetectionMode('medium');
            
            // Load default profile
            loadProfile('default');
            
            // Setup responsive canvas handling
            window.addEventListener('resize', setupCanvases);
            
            console.log('🎯 Advanced Sound Detection & Analysis System READY');
            console.log('- AI Classification: INITIALIZED');
            console.log('- 3D Sound Mapping: READY');
            console.log('- Real-time Spectrogram: STANDBY');
            console.log('- Distance Estimation: CALIBRATED');
            console.log('- Direction Detection: ACTIVE');
            console.log('- Multiple Detection Modes: AVAILABLE');
        });
    </script>
</body>
</html>